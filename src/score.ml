open Board
open Piece

let score_general=
[
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  1;  1;  1;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  2;  2;  2;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0; 11; 15; 11;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0
]

let score_advisor=
[
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0; 20;  0; 20;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0; 23;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0; 20;  0; 20;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0
]

let score_elephant=
[
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0; 20;  0;  0;  0; 20;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0; 18;  0;  0;  0; 23;  0;  0;  0; 18;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0; 20;  0;  0;  0; 20;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0
]

let score_horse=
[
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0; 90; 90; 90; 96; 90; 96; 90; 90; 90;  0;  0;  0;  0;
0;  0;  0; 90; 96;103; 97; 94; 97;103; 96; 90;  0;  0;  0;  0;
0;  0;  0; 92; 98; 99;103; 99;103; 99; 98; 92;  0;  0;  0;  0;
0;  0;  0; 93;108;100;107;100;107;100;108; 93;  0;  0;  0;  0;
0;  0;  0; 90;100; 99;103;104;103; 99;100; 90;  0;  0;  0;  0;
0;  0;  0; 90; 98;101;102;103;102;101; 98; 90;  0;  0;  0;  0;
0;  0;  0; 92; 94; 98; 95; 98; 95; 98; 94; 92;  0;  0;  0;  0;
0;  0;  0; 93; 92; 94; 95; 92; 95; 94; 92; 93;  0;  0;  0;  0;
0;  0;  0; 85; 90; 92; 93; 78; 93; 92; 90; 85;  0;  0;  0;  0;
0;  0;  0; 88; 85; 90; 88; 90; 88; 90; 85; 88;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0
]

let score_rook=
[
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;206;208;207;213;214;213;207;208;206;  0;  0;  0;  0;
0;  0;  0;206;212;209;216;233;216;209;212;206;  0;  0;  0;  0;
0;  0;  0;206;208;207;214;216;214;207;208;206;  0;  0;  0;  0;
0;  0;  0;206;213;213;216;216;216;213;213;206;  0;  0;  0;  0;
0;  0;  0;208;211;211;214;215;214;211;211;208;  0;  0;  0;  0;
0;  0;  0;208;212;212;214;215;214;212;212;208;  0;  0;  0;  0;
0;  0;  0;204;209;204;212;214;212;204;209;204;  0;  0;  0;  0;
0;  0;  0;198;208;204;212;212;212;204;208;198;  0;  0;  0;  0;
0;  0;  0;200;208;206;212;200;212;206;208;200;  0;  0;  0;  0;
0;  0;  0;194;206;204;212;200;212;204;206;194;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0
]

let score_cannon=
[
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;100;100; 96; 91; 90; 91; 96;100;100;  0;  0;  0;  0;
0;  0;  0; 98; 98; 96; 92; 89; 92; 96; 98; 98;  0;  0;  0;  0;
0;  0;  0; 97; 97; 96; 91; 92; 91; 96; 97; 97;  0;  0;  0;  0;
0;  0;  0; 96; 99; 99; 98;100; 98; 99; 99; 96;  0;  0;  0;  0;
0;  0;  0; 96; 96; 96; 96;100; 96; 96; 96; 96;  0;  0;  0;  0;
0;  0;  0; 95; 96; 99; 96;100; 96; 99; 96; 95;  0;  0;  0;  0;
0;  0;  0; 96; 96; 96; 96; 96; 96; 96; 96; 96;  0;  0;  0;  0;
0;  0;  0; 97; 96;100; 99;101; 99;100; 96; 97;  0;  0;  0;  0;
0;  0;  0; 96; 97; 98; 98; 98; 98; 98; 97; 96;  0;  0;  0;  0;
0;  0;  0; 96; 96; 97; 99; 99; 99; 97; 96; 96;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0
]

let score_soldier=
[
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  9;  9;  9; 11; 13; 11;  9;  9;  9;  0;  0;  0;  0;
0;  0;  0; 19; 24; 34; 42; 44; 42; 34; 24; 19;  0;  0;  0;  0;
0;  0;  0; 19; 24; 32; 37; 37; 37; 32; 24; 19;  0;  0;  0;  0;
0;  0;  0; 19; 23; 27; 29; 30; 29; 27; 23; 19;  0;  0;  0;  0;
0;  0;  0; 14; 18; 20; 27; 29; 27; 20; 18; 14;  0;  0;  0;  0;
0;  0;  0;  7;  0; 13;  0; 16;  0; 13;  0;  7;  0;  0;  0;  0;
0;  0;  0;  7;  0;  7;  0; 15;  0;  7;  0;  7;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;
0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0;  0
]


let transform_position (p:position): int=
let row=3+(snd p) in
let col=3+(fst p) in
16*(row-1)+col-1


(* initialize AI's color to red*)
let col = ref true


let evaluate (b:board) (c:bool)=
let score=ref 0 in
let ()=
for i=1 to 9 do
  for j=1 to 10 do
    begin
     match (check_position b (i,j)) with
     |None -> ()
     |Some pie->let sp=ref 0 in
      let ()=
      begin
       match pie.type_of with
        |General->(if pie.team=false then
          sp:=List.nth score_general (transform_position (i,j))
        else sp:=- (List.nth score_general (transform_position (10-i,11-j)))
        )
        |Advisor->(if pie.team=false then
          sp:=List.nth score_advisor (transform_position (i,j))
        else sp:=- (List.nth score_advisor (transform_position (10-i,11-j)))
        )
        |Elephant->(if pie.team=false then
          sp:=List.nth score_elephant (transform_position (i,j))
        else sp:=- (List.nth score_elephant (transform_position (10-i,11-j)))
        )
        |Horse->(if pie.team=false then
          sp:=List.nth score_horse (transform_position (i,j))
        else sp:=- (List.nth score_horse (transform_position (10-i,11-j)))
        )
        |Rook->(if pie.team=false then
          sp:=List.nth score_rook (transform_position (i,j))
        else sp:=- (List.nth score_rook (transform_position (10-i,11-j)))
        )
        |Cannon->(if pie.team=false then
          sp:=List.nth score_cannon (transform_position (i,j))
        else sp:=- (List.nth score_cannon (transform_position (10-i,11-j)))
        )
        |Soldier->(if pie.team=false then
          sp:=List.nth score_soldier (transform_position (i,j))
        else sp:=-(List.nth score_soldier (transform_position (10-i,11-j)))
        )
      end
      in score:=!score+(!sp)
    end
  done
done
in let ()=if c=true then score:=(-(!score)) else () in

let ()=if c=true then
          (if (not (check_alive b "GR")) then score:=!score-10000
          else if (not (check_alive b "GB")) then score:=!score+10000
          else ())
       else
           (if (not (check_alive b "GB")) then score:=!score-10000
           else if (not (check_alive b "GR")) then score:=!score+10000
           else ())
in
 !score

let eval_board (b:board) (ai_col:bool) =evaluate b ai_col
